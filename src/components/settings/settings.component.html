<div class="flex flex-col min-h-full bg-gray-50 text-gray-800">
  <header class="h-16 border-b border-gray-200 bg-white px-6 flex items-center sticky top-0 z-10">
    <div>
      <p class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Admin &gt; Configurações</p>
      <h1 class="text-xl font-bold text-gray-900">Configuração Geral</h1>
    </div>
  </header>

  <div class="flex-1 overflow-y-auto px-4 pt-4">
    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-4">
      <!-- Coluna 1 -->
      <section class="bg-white shadow-sm border border-gray-200 rounded-xl p-6">
        <div class="space-y-4">
          <div>
            <h2 class="text-lg font-semibold text-gray-900">Ativar/Desativar Módulos</h2>
          </div>
          <div class="space-y-2">
            @for (item of moduleToggles(); track item.id) {
              <div class="rounded-xl border border-gray-200 bg-white">
                <button (click)="toggleModule(item.id)"
                  class="w-full flex items-center justify-between rounded-lg px-4 py-3">
                  <span class="font-medium text-gray-900">{{ item.label }}</span>
                  <span class="relative inline-flex h-6 w-11 items-center rounded-full transition"
                    [class.bg-purple-600]="item.enabled" [class.bg-gray-200]="!item.enabled">
                    <span class="absolute h-5 w-5 rounded-full bg-white shadow transform transition"
                      [class.translate-x-5]="item.enabled" [class.translate-x-0]="!item.enabled"></span>
                  </span>
                </button>
                @if (item.id === 'smartsap' && item.enabled) {
                  <div class="border-t border-gray-200 px-4 py-4 space-y-3 bg-gray-50 rounded-b-xl">
                    <div class="flex items-center justify-between text-sm">
                      <span class="text-gray-600">Ciclo de faturamento</span>
                      <span class="font-semibold text-gray-900">{{ smartsapBilling().billingCycle }}</span>
                    </div>
                    <div class="space-y-2 text-sm">
                      <div class="flex items-center justify-between">
                        <span class="text-gray-600">Créditos disponíveis</span>
                        <span class="text-lg font-semibold text-gray-900">{{ smartsapBilling().creditsAvailable }}</span>
                      </div>
                      <div class="flex items-center justify-between">
                        <span class="text-gray-600">Créditos usados</span>
                        <span class="text-lg font-semibold text-gray-900">{{ smartsapBilling().creditsUsed }}</span>
                      </div>
                    </div>
                    <div class="flex items-center gap-2">
                      <button (click)="buyMoreCredits()" class="bg-purple-700 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-purple-800 transition">Comprar créditos</button>
                      <button (click)="viewStatement()" class="px-4 py-2 rounded-full text-sm font-semibold border border-gray-300 text-gray-800 hover:border-gray-400 transition">Ver extrato</button>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </section>

      <!-- Coluna 2 -->
      <section class="bg-white shadow-sm border border-gray-200 rounded-xl p-6 space-y-6">
        <div>
          <h2 class="text-lg font-semibold text-gray-900">Outras configurações</h2>
        </div>

        @for (item of otherConfigs(); track item.id) {
          <div class="space-y-2 pb-4 border-b border-gray-200 last:border-b-0 last:pb-0">
            <button (click)="toggleOther(item.id)"
              class="w-full flex items-center justify-between rounded-lg px-4 py-3 border border-gray-200 bg-white transition hover:border-gray-300">
              <span class="font-medium text-gray-900">{{ item.label }}</span>
              <span class="relative inline-flex h-6 w-11 items-center rounded-full transition"
                [class.bg-purple-600]="item.enabled" [class.bg-gray-200]="!item.enabled">
                <span class="absolute h-5 w-5 rounded-full bg-white shadow transform transition"
                  [class.translate-x-5]="item.enabled" [class.translate-x-0]="!item.enabled"></span>
              </span>
            </button>
            @if (item.description) {
              <p class="text-xs text-gray-600 leading-relaxed">{{ item.description }}</p>
            }
          </div>
        }

        <div>
          <h3 class="text-sm font-semibold text-gray-900 mb-2">Exibição de Conteúdos</h3>
          <p class="text-xs text-gray-600 mb-3">Personalize a página de cursos configurando quais tipos serão exibidos aos usuários:</p>
          <div class="space-y-2 border border-dashed border-gray-200 rounded-lg p-3 bg-gray-50">
            @for (item of contentVisibility(); track item.id) {
              <div class="w-full flex items-center justify-between rounded-md px-3 py-2 border border-transparent hover:border-gray-200">
                <span class="text-sm font-medium text-gray-900">{{ item.label }}</span>
                <button (click)="toggleContent(item.id)"
                  class="relative inline-flex h-6 w-11 items-center rounded-full transition"
                  [class.bg-purple-600]="item.enabled" [class.bg-gray-200]="!item.enabled">
                  <span class="absolute h-5 w-5 rounded-full bg-white shadow transform transition"
                    [class.translate-x-5]="item.enabled" [class.translate-x-0]="!item.enabled"></span>
                </button>
              </div>
            }
          </div>
        </div>
      </section>

      <!-- Coluna 3 -->
      <section class="bg-white shadow-sm border border-gray-200 rounded-xl p-6 space-y-8">
        <div class="space-y-4">
          <div>
            <h2 class="text-lg font-semibold text-gray-900">Performance mínima para aprovação</h2>
            <p class="text-sm text-gray-700">Configure a performance mínima para aprovação e geração de certificado de um curso. Novos valores só serão refletidos na novas matrículas concluídas.</p>
          </div>
          <div class="space-y-2">
            <div class="flex items-center gap-3">
              <input type="number" min="0" max="100" [ngModel]="performanceMinimum()" (ngModelChange)="performanceMinimum.set(toNumber($event))"
                class="w-24 px-3 py-2 border rounded-lg focus:border-purple-600 focus:ring-purple-500 outline-none" />
              <button (click)="savePerformance()" class="bg-purple-700 text-white px-4 py-2 rounded-full font-semibold hover:bg-purple-800 transition">Salvar</button>
            </div>
            <p class="text-xs text-gray-600">Informe um valor entre 0% e 100%.</p>
            @if (performanceError(); as err) {
              <p class="text-xs text-red-600 font-semibold">{{ err }}</p>
            }
          </div>
        </div>

        <div class="space-y-3">
          <h2 class="text-lg font-semibold text-gray-900">Meta para conclusão dos cursos</h2>
          <p class="text-sm text-gray-700">Defina o valor base para a data meta de conclusão dos cursos em sua workspace.</p>
          <input type="number" min="0" [ngModel]="goalDays()" (ngModelChange)="goalDays.set(toNumber($event))"
            class="w-40 px-3 py-2 border rounded-lg focus:border-purple-600 focus:ring-purple-500 outline-none" />
          <p class="text-sm text-gray-600">dias(s)</p>
          <div>
            <button (click)="saveGoal()" class="bg-purple-700 text-white px-4 py-2 rounded-full font-semibold hover:bg-purple-800 transition">Salvar</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  @if (statementOpen()) {
    <div class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center px-4 z-50" (click)="closeStatement()">
      <div class="w-full max-w-3xl bg-white rounded-2xl shadow-xl border border-gray-200 relative z-50" (click)="$event.stopPropagation()">
        <div class="p-6 border-b border-gray-200">
          <h3 class="text-lg font-semibold text-gray-900">Extrato SmartSap</h3>
          <p class="text-sm text-gray-600">Histórico de compras e uso de créditos.</p>
        </div>
        <div class="p-6 space-y-4">
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="rounded-xl bg-gray-50 border border-gray-200 px-4 py-3">
              <p class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Saldo acumulado</p>
              <p class="text-2xl font-bold text-gray-900">{{ statementSummary().accumulated }}</p>
              <p class="text-xs text-gray-500">créditos</p>
            </div>
            <div class="rounded-xl bg-gray-50 border border-gray-200 px-4 py-3">
              <p class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Plano mensal</p>
              <p class="text-2xl font-bold text-gray-900">{{ statementSummary().monthlyPlan }}</p>
              <p class="text-xs text-gray-500">créditos</p>
            </div>
            <div class="rounded-xl bg-gray-50 border border-gray-200 px-4 py-3">
              <p class="text-xs uppercase tracking-wide text-gray-500 font-semibold">Ciclo atual</p>
              <p class="text-sm font-semibold text-gray-900">{{ statementSummary().cycleStart }}</p>
              <p class="text-sm font-semibold text-gray-900">{{ statementSummary().cycleEnd }}</p>
            </div>
          </div>

          <div class="border border-gray-200 rounded-xl overflow-hidden">
            <div class="bg-gray-50 px-4 py-2 text-sm font-semibold text-gray-700">Histórico</div>
            <div class="divide-y divide-gray-200">
              <div class="grid grid-cols-4 px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wide">
                <span>Ciclo</span>
                <span class="text-right">Utilizado</span>
                <span class="text-right">Saldo</span>
                <span class="text-right">Crédito</span>
              </div>
              @for (item of statementHistory(); track item.cycle) {
                <div class="grid grid-cols-4 px-4 py-2 text-sm text-gray-800">
                  <span>{{ item.cycle }}</span>
                  <span class="text-right">{{ item.used }}</span>
                  <span class="text-right">{{ item.balance }}</span>
                  <span class="text-right">{{ item.credit }}</span>
                </div>
              }
            </div>
          </div>
        </div>
        <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
          <button (click)="closeStatement()" class="px-4 py-2 rounded-full text-sm font-semibold border border-gray-300 text-gray-800 hover:border-gray-400 transition">
            Fechar
          </button>
        </div>
      </div>
    </div>
  }

  @if (purchaseOpen()) {
    <div class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center px-4 z-50" (click)="closePurchase()">
      <div class="w-full max-w-4xl bg-white rounded-2xl shadow-xl border border-gray-200 relative z-50" (click)="$event.stopPropagation()">
        <div class="p-6 border-b border-gray-200 flex items-center justify-between">
          <div>
            <h3 class="text-lg font-semibold text-gray-900">Comprar créditos SmartSap</h3>
            <p class="text-sm text-gray-600">Escolha quantos créditos deseja comprar. O detalhamento por curso ocorre na criação dos cursos SmartZap.</p>
          </div>
          <button (click)="closePurchase()" class="text-gray-500 hover:text-gray-700">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <div class="p-6 grid grid-cols-1 lg:grid-cols-[1.4fr_1fr] gap-4">
          <div class="space-y-6">
            <div class="space-y-3">
              <div class="flex items-center justify-between text-sm text-gray-700">
                <span>Base de preço</span>
                <span class="px-3 py-1 rounded-full bg-gray-100 text-gray-800 font-semibold">DDD Brasil</span>
              </div>
              <div class="flex items-center justify-between text-sm text-gray-700">
                <span>Quantidade de créditos</span>
                <span class="font-semibold">{{ purchaseCredits() | number }}</span>
              </div>
              <input type="range" min="1000" max="100000" step="1000"
                [ngModel]="purchaseForm().credits"
                (ngModelChange)="updatePurchase('credits', toNumber($event))"
                class="w-full accent-purple-700" />
              <div class="flex justify-between text-xs text-gray-500">
                <span>1k</span><span>10k</span><span>20k</span><span>50k</span><span>100k</span>
              </div>
            </div>
          </div>

          <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Total de créditos</span>
              <span class="text-2xl font-bold text-gray-900">{{ purchaseCredits() | number }}</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Preço por crédito (R$)</span>
              <span class="text-sm font-semibold text-gray-900">R$ {{ purchaseForm().pricePerCredit | number:'1.2-4' }}</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Total em R$</span>
              <span class="text-xl font-semibold text-gray-900">R$ {{ purchaseTotal() | number:'1.2-2' }}</span>
            </div>
            <div class="text-xs text-gray-500">
              Compras baseadas em DDD Brasil. Custos extras por alunos com DDD internacional serão exibidos e estimados na criação dos cursos SmartZap.
            </div>
            <button (click)="proceedToCheckout()" class="w-full bg-purple-700 text-white px-4 py-3 rounded-full font-semibold hover:bg-purple-800 transition">Ir para checkout</button>
            <button (click)="closePurchase()" class="w-full border border-gray-300 text-gray-800 px-4 py-2 rounded-full font-semibold hover:border-gray-400 transition">Cancelar</button>
          </div>
        </div>
      </div>
    </div>
  }

  @if (checkoutOpen()) {
    <div class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center px-4 z-50" (click)="closeCheckout()">
      <div class="w-full max-w-5xl bg-white rounded-2xl shadow-xl border border-gray-200 relative z-50" (click)="$event.stopPropagation()">
        <div class="p-6 border-b border-gray-200 flex items-center justify-between">
          <div>
            <h3 class="text-lg font-semibold text-gray-900">Checkout SmartSap</h3>
            <p class="text-sm text-gray-600">Confirme dados de cobrança e finalize a compra de créditos.</p>
          </div>
          <button (click)="closeCheckout()" class="text-gray-500 hover:text-gray-700">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <div class="p-6 grid grid-cols-1 lg:grid-cols-[1.15fr_0.85fr] gap-6">
          <div class="space-y-6">
            <div class="flex items-center gap-2 text-xs font-semibold text-gray-600">
              <span class="px-2 py-1 rounded-full border border-gray-300 bg-gray-100">1</span><span>Resumo</span>
              <span class="px-2 py-1 rounded-full border border-purple-200 bg-purple-50 text-purple-700">2</span><span>Pagamento</span>
              <span class="px-2 py-1 rounded-full border border-gray-200 bg-gray-50">3</span><span>Confirmação</span>
            </div>

            <div class="border border-gray-200 rounded-xl p-4 space-y-1 bg-white">
              <h4 class="text-sm font-semibold text-gray-900">Informações de cobrança</h4>
              <p class="text-sm text-gray-800 font-semibold">{{ billing().name }}</p>
              <p class="text-sm text-gray-700">{{ billing().company }}</p>
              <p class="text-sm text-gray-700">{{ billing().address }}</p>
              <p class="text-sm text-gray-600">{{ billing().taxId }}</p>
            </div>

            <div class="border border-gray-200 rounded-xl p-4 space-y-4 bg-white">
              <div class="flex gap-2">
                <button (click)="setPaymentMethod('card')"
                  class="px-4 py-2 rounded-full border text-sm font-semibold transition"
                  [class.bg-purple-700]="paymentMethod() === 'card'"
                  [class.text-white]="paymentMethod() === 'card'"
                  [class.border-purple-200]="paymentMethod() === 'card'"
                  [class.bg-white]="paymentMethod() !== 'card'"
                  [class.text-gray-800]="paymentMethod() !== 'card'"
                  [class.border-gray-300]="paymentMethod() !== 'card'">Cartão de crédito</button>
                <button (click)="setPaymentMethod('boleto')"
                  class="px-4 py-2 rounded-full border text-sm font-semibold transition"
                  [class.bg-purple-700]="paymentMethod() === 'boleto'"
                  [class.text-white]="paymentMethod() === 'boleto'"
                  [class.border-purple-200]="paymentMethod() === 'boleto'"
                  [class.bg-white]="paymentMethod() !== 'boleto'"
                  [class.text-gray-800]="paymentMethod() !== 'boleto'"
                  [class.border-gray-300]="paymentMethod() !== 'boleto'">Boleto</button>
              </div>

              @if (paymentMethod() === 'card') {
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                  <label class="space-y-1 text-sm text-gray-700">
                    <span class="font-semibold">Número do cartão</span>
                    <input type="text" maxlength="19" [ngModel]="cardForm().cardNumber" (ngModelChange)="updateCard('cardNumber', $event)"
                      class="w-full px-3 py-2 border rounded-lg focus:border-purple-600 focus:ring-purple-500 outline-none" />
                  </label>
                  <label class="space-y-1 text-sm text-gray-700">
                    <span class="font-semibold">Nome impresso</span>
                    <input type="text" [ngModel]="cardForm().cardName" (ngModelChange)="updateCard('cardName', $event)"
                      class="w-full px-3 py-2 border rounded-lg focus:border-purple-600 focus:ring-purple-500 outline-none" />
                  </label>
                  <label class="space-y-1 text-sm text-gray-700">
                    <span class="font-semibold">Validade (MM/AA)</span>
                    <input type="text" maxlength="5" [ngModel]="cardForm().cardExpiry" (ngModelChange)="updateCard('cardExpiry', $event)"
                      class="w-full px-3 py-2 border rounded-lg focus:border-purple-600 focus:ring-purple-500 outline-none" />
                  </label>
                  <label class="space-y-1 text-sm text-gray-700">
                    <span class="font-semibold">CVV</span>
                    <input type="text" maxlength="4" [ngModel]="cardForm().cardCvv" (ngModelChange)="updateCard('cardCvv', $event)"
                      class="w-full px-3 py-2 border rounded-lg focus:border-purple-600 focus:ring-purple-500 outline-none" />
                  </label>
                </div>
              }

              @if (paymentMethod() === 'boleto') {
                <div class="space-y-2">
                  <label class="space-y-1 text-sm text-gray-700 block">
                    <span class="font-semibold">E-mail para envio do boleto</span>
                    <input type="email" [ngModel]="boletoForm().email" (ngModelChange)="updateBoleto('email', $event)"
                      class="w-full px-3 py-2 border rounded-lg focus:border-purple-600 focus:ring-purple-500 outline-none" />
                  </label>
                  <p class="text-xs text-gray-500">O boleto será enviado em até 5 minutos e terá vencimento de 3 dias corridos.</p>
                </div>
              }
            </div>
          </div>

          <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Total de créditos</span>
              <span class="text-2xl font-bold text-gray-900">{{ purchaseCredits() | number }}</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Preço por crédito (R$)</span>
              <span class="text-sm font-semibold text-gray-900">R$ {{ purchaseForm().pricePerCredit | number:'1.2-4' }}</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Total em R$</span>
              <span class="text-xl font-semibold text-gray-900">R$ {{ purchaseTotal() | number:'1.2-2' }}</span>
            </div>
            <div class="text-xs text-gray-500">
              Pagamento baseado em DDD Brasil. Custos extras para alunos com DDD internacional são tratados nos cursos SmartZap.
            </div>
            <button (click)="finalizeCheckout()" class="w-full bg-purple-700 text-white px-4 py-3 rounded-full font-semibold hover:bg-purple-800 transition">
              @if (paymentMethod() === 'boleto') { Gerar boleto } @else { Pagar agora }
            </button>
            <button (click)="closeCheckout()" class="w-full border border-gray-300 text-gray-800 px-4 py-2 rounded-full font-semibold hover:border-gray-400 transition">Cancelar</button>
          </div>
        </div>
      </div>
    </div>
  }
</div>
